<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Computer Science</title>
  <link rel="stylesheet" href="mstyle.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
</head>

<body>
  <div class="container-fluid py-3 text-center">
    <h1>Access Files Uploaded by Instructor</h1>
  </div>
  <div>
    <div class="text-center">
      <img src="logo.png" id="logo">
      <h1>UniGrade</h1>
      <div class="container mt-3">
          <table class="table table-dark">
              <thead>
                  <th>Select FileName from Uploaded Files</th>
              </thead>
              <tbody id="tbody1"></tbody>
          </table>
      </div>
      <label style="margin-top: 3%; font-weight: bold;">FileName Without Extension</label><br>
      <input type="text" class="text-center" placeholder="FileName" id="namebox">
      <label id="extlab"></label>
      <button id="downbtn" onclick="openVisible()" style="background-color: black; color: white;">Get File</button>
  </div>
  <br><br>
  <p id="FileName" class="text-center" style="font-weight: bold;">Click on Open File when FileName appears here</p>
  <br>
  <div class="text-center" id="myDiv"> 
      <a href="#" id="myAnchor" target="_blank" style="background-color: black; padding: 0.9%; text-decoration: none; color: white;">Open File</a><br><br>
  </div>
  <br><br>
  <img id="myimg" style="visibility: hidden; height: 20px; width: 20px;">
  
  <br><br>
  </div>


<div class="container-fluid py-2" id="course-head">
  <h2 class="display-6 fw-bold text-center">Quiz</h2>
</div>
<div class="text-center py-4">
<button class="btn btn-primary text-center py-3"><a href="https://arkaprabhachowdhury.github.io/csquiz/" target="_blank" class="text-dark fw-bold text-decoration-none">Take the quiz!</a></button>
</div>
<div class="container-fluid py-2" id="course-head">
  <h2 class="display-6 fw-bold text-center" id="quiz">Related Courses</h2>
</div>

  <main>
    <div class="container-fluid bg-trasparent my-4 p-3" style="position: relative;">
      <div class="row row-cols-1 row-cols-xs-2 row-cols-sm-2 row-cols-lg-4 g-3">
        <div class="col">
          <div class="card h-100 shadow-sm"> <img
              src="udemy.png"
              class="card-img-top" alt="...">
            <div class="card-body">
              <div class="clearfix mb-3"> <span class="float-start badge rounded-pill bg-primary">Rs 449</span>  </div>
              
              <a href="https://www.udemy.com/course/operating-systems-from-scratch-part1/" target="_blank" class="card-text stretched-link text-decoration-none">Operating Systems from scratch - Part 1</a>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100 shadow-sm"> <img
              src="edx.png"
              class="card-img-top" alt="...">
            <div class="card-body">
              <div class="clearfix mb-3"> <span class="float-start badge rounded-pill bg-primary">Free</span>  </div>
              
              <a href="https://www.edx.org/course/introduction-computer-science-harvardx-cs50x" target="_blank" class="card-text stretched-link text-decoration-none">CS50's Introduction to Computer Science</a>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100 shadow-sm"> <img
              src="coursera.png"
              class="card-img-top" alt="...">
            <div class="card-body">
              <div class="clearfix mb-3"> <span class="float-start badge rounded-pill bg-primary">Free</span>  </div>
              
              <a href="https://www.coursera.org/learn/algorithms-part1" target="_blank" class="card-text stretched-link text-decoration-none">Algorithms, Part I</a>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100 shadow-sm"> <img
              src="coursera.png"
              class="card-img-top" alt="...">
            <div class="card-body">
              <div class="clearfix mb-3"> <span class="float-start badge rounded-pill bg-primary">Rs 1000-3000</span>  </div>
              
              <a href="https://www.coursera.org/learn/computer-networking" target="_blank" class="card-text stretched-link text-decoration-none">The Bits and Bytes of Computer Networking</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>
    <df-messenger intent="WELCOME" chat-title="Buddy!" agent-id="d3a47dbe-b098-4800-8090-68e734ef3611" language-code="en">
    </df-messenger>
</body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
  import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-storage.js";
  import { getFirestore, doc, getDoc, getDocs, setDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAXK1OqdT_w-87Y2DFJhhe0EWQdl-E3fgg",
    authDomain: "student-connect-cdafe.firebaseapp.com",
    projectId: "student-connect-cdafe",
    storageBucket: "student-connect-cdafe.appspot.com",
    messagingSenderId: "696405092513",
    appId: "1:696405092513:web:8ef843e289626db7a968e0",
    measurementId: "G-6KZW84VQQ3",
    databaseURL: "https://student-connect-cdafe-default-rtdb.firebaseio.com/"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const clouddb = getFirestore();
  var files = [];

  var namebox = document.getElementById('namebox');
  var extlab = document.getElementById('extlab');
  var myimg = document.getElementById('myimg');
  var DownBtn = document.getElementById('downbtn');
  
  function GetFileExt(file){
      var temp = file.name.split('.');
      var ext = temp.slice((temp.length-1),(temp.length));
      return '.'+ext[0];
  }

  function GetFileName(file){
      var temp = file.name.split('.');
      var fname = temp.slice(0,-1).join('.');
      return fname;
  }


  async function SaveURLtoFirestore(url){
      var name = namebox.value;
      var ext = extlab.innerHTML;

      var ref = doc(clouddb, "ImageLinks/"+name);

      await setDoc(ref, {
          ImageName: (name+ext),
          ImageURL: url
      })
  }

  async function GetImagefromFirestore(){
      var name = namebox.value;
      var ref = doc(clouddb, "ImageLinks/"+name);
      const docSnap = await getDoc(ref);
      if(docSnap.exists()){
          myimg.src = docSnap.data().ImageURL;
          document.getElementById("myAnchor").href = docSnap.data().ImageURL;
          document.getElementById("FileName").innerText = docSnap.data().ImageName
      }
  }

  var tbody = document.getElementById("tbody1");

  function AddItemToTable(link){
      let trow = document.createElement("tr");
      let td1 = document.createElement("td");
      td1.innerHTML = link;
      trow.appendChild(td1);
      tbody.appendChild(trow);
  }


  function AddAllItemsToTable(linkslist){
      tbody.innerHTML = "";
      linkslist.forEach(element =>{
          AddItemToTable(element.ImageName)
      });
  }
  async function GetAllDataRealtime(){
      const dbRef = collection(clouddb, "ImageLinks");
      onSnapshot(dbRef, (querySnapshot)=>{
          var fileName = [];

          querySnapshot.forEach(doc => {
              fileName.push(doc.data());
          });

          AddAllItemsToTable(fileName);
      })
      

  }
  DownBtn.onclick = GetImagefromFirestore;
  window.onload = GetAllDataRealtime;
</script>
</html>
